<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>赣南客家话词典</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header>
    <nav>
      <ul>
        <li><a href="#search">查询</a></li>
        <li><a href="#manage">数据</a></li>
        <li><a href="#about">说明</a></li>
      </ul>
    </nav>
    <h1>GAN-NAN HAKKA DICT</h1>
  </header>

  <section id="search" class="content-section">
    <h2>查询</h2>
    <h3>汉字 / 转写 / IPA / 释义 / 例句 都可搜（支持模糊）</h3>

    <div class="searchbar">
      <input id="q" type="search" placeholder="例如：侬 / nung2 / nung / [nuŋ] / second person" autocomplete="off" />
      <button id="btnSearch">搜索</button>
    </div>

    <div class="filters">
      <div class="chip-group" aria-label="方言">
        <button class="chip is-active" data-dialect="all">全部</button>
        <button class="chip" data-dialect="gannan_hakka">赣南客家话</button>
      </div>

      <div class="chip-group" aria-label="词性">
        <button class="chip is-active" data-pos="all">全部词性</button>
        <button class="chip" data-pos="n">名词</button>
        <button class="chip" data-pos="v">动词</button>
        <button class="chip" data-pos="adj">形容词</button>
        <button class="chip" data-pos="pron">代词</button>
        <button class="chip" data-pos="part">语气词</button>
        <button class="chip" data-pos="other">其他</button>
      </div>

      <label class="toggle">
        <input id="toggleIPA" type="checkbox" checked />
        <span>显示 IPA</span>
      </label>

      <label class="toggle">
        <input id="toggleAudio" type="checkbox" checked />
        <span>显示发音</span>
      </label>
    </div>

    <p class="muted" id="hint">
      点击左侧结果看详情；发音支持：录音→本机保存（IndexedDB）→上传到你的 Google Drive（需部署 Apps Script）。
    </p>

    <div class="split">
      <aside class="panel panel-left" aria-label="搜索结果">
        <div class="panel-head">
          <h3>结果</h3>
          <p class="small" id="resultMeta">0 条</p>
        </div>
        <div id="results" class="results"></div>
      </aside>

      <main class="panel panel-right" aria-label="词条详情">
        <div class="panel-head">
          <h3>词条</h3>
          <div class="head-actions">
            <button id="btnStar" class="icon-btn" disabled title="收藏">☆</button>
            <button id="btnCopy" class="icon-btn" disabled title="复制">⎘</button>
          </div>
        </div>

        <div id="entry" class="entry empty">
          <p>先搜一个词，或者点左侧示例结果。</p>
        </div>
      </main>
    </div>
  </section>

  <section id="manage" class="content-section">
    <h2>数据</h2>
    <h3>导入 / 导出 / 重置（纯静态，可放 GitHub Pages）</h3>

    <div class="manage-grid">
      <div class="card">
        <h3>导入（JSON / CSV）</h3>
        <p class="muted">导入后会覆盖当前词条（保存到浏览器本地）。</p>
        <div class="controls">
          <input id="fileImport" type="file" accept=".json,.csv,text/csv,application/json" />
          <button id="btnImport" class="btn">导入</button>
        </div>
        <p class="small" id="importStatus">未导入</p>
      </div>

      <div class="card">
        <h3>导出（JSON）</h3>
        <p class="muted">导出的是“词条文本数据”。录音文件保存在浏览器 IndexedDB，不会自动打包进 JSON。</p>
        <div class="controls">
          <button id="btnExport" class="btn">导出 JSON</button>
          <button id="btnClearAudio" class="btn btn-ghost">清空所有录音</button>
        </div>
        <p class="small" id="exportStatus">—</p>
      </div>

      <div class="card">
        <h3>重置</h3>
        <p class="muted">回到仓库自带示例数据。</p>
        <div class="controls">
          <button id="btnReset" class="btn btn-danger">重置数据</button>
        </div>
        <p class="small" id="resetStatus">—</p>
      </div>
    </div>

    <div class="card" style="margin-top:18px;">
      <h3>CSV 格式示例</h3>
      <p class="muted">列表字段：senses/tags 用 ||；examples 用 句子::注释，再用 || 分隔。</p>
      <pre class="codeblock" id="csvExample"></pre>
    </div>

    <div class="card" style="margin-top:18px;">
      <h3>JSON 示例</h3>
      <pre class="codeblock" id="jsonExample"></pre>
    </div>
  </section>

  <section id="about" class="content-section">
    <h2>说明</h2>
    <h3>Drive 上传怎么接</h3>
    <p>
      你需要把本包里的 <b>apps_script.gs</b> 复制到 Google Apps Script，部署成 Web App，
      然后把生成的 URL 粘到 <b>app.js</b> 里的 <b>DRIVE_UPLOAD_ENDPOINT</b>。
      上传会把录音保存到你指定的 Drive 文件夹里（默认 DialectAudio）。
    </p>
  </section>

  <footer>
    <p>© GAN-NAN HAKKA DICT</p>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
